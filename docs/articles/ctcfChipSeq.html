<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="igvR">
<title>Explore ChIP-seq alignments from a bam file, MACS2 narrowPeaks, conservation, H3K4me3 methylation and motif matching • igvR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Explore ChIP-seq alignments from a bam file, MACS2 narrowPeaks, conservation, H3K4me3 methylation and motif matching">
<meta property="og:description" content="igvR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">igvR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.15.12</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/alzheimersVariantsNearMEF2C.html">Explore VCF variants, GWAS snps, promoters and histone marks around the  MEF2C gene in Alzheimers Disease</a>
    <a class="dropdown-item" href="../articles/basicIntro.html">Introduction: a simple demo</a>
    <a class="dropdown-item" href="../articles/chooseStockOrCustomGenome.html">Choose aStock or Custom Genome</a>
    <a class="dropdown-item" href="../articles/ctcfChipSeq.html">Explore ChIP-seq alignments from a bam file, MACS2 narrowPeaks, conservation, H3K4me3 methylation and motif matching</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Explore ChIP-seq alignments from a bam file, MACS2 narrowPeaks, conservation, H3K4me3 methylation and motif matching</h1>
                        <h4 data-toc-skip class="author">Paul Shannon</h4>
            
            <h4 data-toc-skip class="date">2022-04-04</h4>
      
      
      <div class="d-none name"><code>ctcfChipSeq.Rmd</code></div>
    </div>

    
    
<style>
.main-container { width: 1200px; max-width:2800px;}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The igvR package provides easy programmatic access in R to the web-based javascript library <a href="https://github.com/igvteam/igv.js" class="external-link">igv.js</a>. R’s access to data, and operations upon data, are complemented by igv’s richly interactive web browser interface to display and explore genomic and epigentic data.</p>
<p>In this vignette we present a somewhat contrived ChIP-seq study - contrived in that it is not organized around an actual research problem. Instead, this vignette demonstrates methods you would likely use to do visual QC and exploratory data analysis a ChIP-seq experiment.</p>
<p>We begin with ENCODE data of CTCF binding on chromosome 3, on the hg19 reference genome, in the vicinity of the GATA2 gene. We will</p>
<ul>
<li>display a 252 kb region of that genome</li>
<li>load and display a GenomicAlignments object from an indexed bam file covering that region</li>
<li>load and display a narrow peaks bedGraph track, precalculated by MACS2</li>
<li>Use the Biostrings::matchPWM method to identify regions in the displayed sequence which, with at least 80% fidelity, match the CTCF motif, Jaspar 2018’s MA0138.1, from MotifDb</li>
<li>Display that motif logo in a browser popup.</li>
<li>load sequence conservation data from the Bioconductor annotation package phastCons100way.UCSC.hg19, looking for the intersection of ChIP peaks, motif match and conserved sequence, all of which together suggest that at such locations functional TF binding occurs.</li>
</ul>
<p>The two images below illustrate the final state of igv in your browser at the conclusion of the code found below. The first view spans 35kb:</p>
<p><img src="igvR-ctcf-vignette-zoomedOut.png" width="911"> The second spans less than 1200 bases.</p>
<p><img src="igvR-ctcf-vignette-zoomedIn.png" width="908"></p>
</div>
<div class="section level2">
<h2 id="load-the-libraries-we-need">Load the libraries we need<a class="anchor" aria-label="anchor" href="#load-the-libraries-we-need"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paul-shannon.github.io/igvR/" class="external-link">igvR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MotifDb</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AnnotationHub</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BSgenome.Hsapiens.UCSC.hg19</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">phastCons100way.UCSC.hg19</span><span class="op">)</span></code></pre></div>
<p>Create the igvR instance, with all default parameters (portRange, quiet, title). Javascript and HTML is loaded into your browser, igv.js is initialized, a websocket connection between your R process and that web page is constructed, over which subsequent commands and data will travel.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">igv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/igvR-class.html">igvR</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://paul-shannon.github.io/BrowserViz/reference/setBrowserWindowTitle.html" class="external-link">setBrowserWindowTitle</a></span><span class="op">(</span><span class="va">igv</span>, <span class="st">"CTCF ChIP-seq"</span><span class="op">)</span>
<span class="fu"><a href="../reference/setGenome.html">setGenome</a></span><span class="op">(</span><span class="va">igv</span>, <span class="st">"hg19"</span><span class="op">)</span></code></pre></div>
<p>Display 1.4MB on chr3 more or less centered on the GATA2 genes</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/showGenomicRegion.html">showGenomicRegion</a></span><span class="op">(</span><span class="va">igv</span>, <span class="st">"chr3:128,079,020-128,331,275"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-granges-object-specifying-our-region-of-interest-obtaining-a-list-chrom-start-end-string-from-igv">Create a GRanges object specifying our region of interest, obtaining a list (chrom, start, end, string) from igv<a class="anchor" aria-label="anchor" href="#create-a-granges-object-specifying-our-region-of-interest-obtaining-a-list-chrom-start-end-string-from-igv"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getGenomicRegion.html">getGenomicRegion</a></span><span class="op">(</span><span class="va">igv</span><span class="op">)</span>
<span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">loc</span>, <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span>seqnames<span class="op">=</span><span class="va">chrom</span>, ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rsamtools/man/ScanBamParam-class.html" class="external-link">ScanBamParam</a></span><span class="op">(</span>which<span class="op">=</span><span class="va">which</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rsamtools/man/ScanBamParam-class.html" class="external-link">scanBamWhat</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">bamFile</span> <span class="op">&lt;-</span> <span class="st">"~/github/ChIPseqMotifMatch/bulk/GSM749704/GSM749704_hg19_wgEncodeUwTfbsGm12878CtcfStdAlnRep1.bam"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">bamFile</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicAlignments/man/readGAlignments.html" class="external-link">readGAlignments</a></span><span class="op">(</span><span class="va">bamFile</span>, use.names<span class="op">=</span><span class="cn">TRUE</span>, param<span class="op">=</span><span class="va">param</span><span class="op">)</span>
<span class="va">track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GenomicAlignmentTrack-class.html">GenomicAlignmentTrack</a></span><span class="op">(</span><span class="st">"ctcf bam"</span>, <span class="va">x</span>, visibilityWindow<span class="op">=</span><span class="fl">10000000</span>, trackHeight<span class="op">=</span><span class="fl">200</span><span class="op">)</span>  <span class="co"># 30000 default</span>
<span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-narrow-peaks-previously-called-by-macs2-from-the-bam-file">Load narrow peaks previously called by MACS2 from the bam file<a class="anchor" aria-label="anchor" href="#load-narrow-peaks-previously-called-by-macs2-from-the-bam-file"></a>
</h2>
<p>We previously ran MACS2 using docker and make, with this makefile, an approach that you may find useful but which requires that you install Docker and the Macs2 image. The resulting narrow peaks file is includes in the package.</p>
<p>Macs2 narrowpeaks produce one possible summary and reduction of the bam pileup, though the bam track histogram is arguably more informative.</p>
<pre><code>DATADIR=/Users/paul/github/igvR/vignettes/macs2
BAM=GSM749704_hg19_wgEncodeUwTfbsGm12878CtcfStdAlnRep1.bam
NAME=GSM749704_hg19_chr19
run:
    docker run -v $(DATADIR):/data/ fooliu/macs2 callpeak -t /data/$(BAM) -n $(NAME) --outdir data/</code></pre>
<p>This produces several files; we are interested only in the narrow peaks:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"igvR"</span>, <span class="st">"extdata"</span>, <span class="st">"GSM749704_hg19_chr19_peaks.narrowPeak"</span><span class="op">)</span>
<span class="va">tbl.pk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"igvR"</span>, <span class="st">"extdata"</span>, <span class="st">"GSM749704_hg19_chr19_subset.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataFrameQuantitativeTrack-class.html">DataFrameQuantitativeTrack</a></span><span class="op">(</span><span class="st">"macs2 peaks"</span>, <span class="va">tbl.pk</span>, color<span class="op">=</span><span class="st">"red"</span>, autoscale<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="match-the-ctcf-motif-against-sequence-in-the-currently-displayed-region">Match the CTCF motif against sequence in the currently displayed region<a class="anchor" aria-label="anchor" href="#match-the-ctcf-motif-against-sequence-in-the-currently-displayed-region"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">dna</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">loc</span>, <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/getSeq.html" class="external-link">getSeq</a></span><span class="op">(</span><span class="va">BSgenome.Hsapiens.UCSC.hg19</span>, <span class="va">chrom</span>, <span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">)</span>
<span class="va">pfm.ctcf</span> <span class="op">&lt;-</span> <span class="fu">MotifDb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MotifDb/man/query.html" class="external-link">query</a></span><span class="op">(</span><span class="va">MotifDb</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTCF"</span>, <span class="st">"sapiens"</span>, <span class="st">"jaspar2018"</span><span class="op">)</span>, notStrings<span class="op">=</span><span class="st">"ctcfl"</span><span class="op">)</span>
<span class="va">motif.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pfm.ctcf</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">pfm</span> <span class="op">&lt;-</span> <span class="va">pfm.ctcf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-matchpwm-from-the-biostrings-package-to-match-the-motif-on-both-strands">Use matchPWM from the Biostrings package to match the motif on both strands<a class="anchor" aria-label="anchor" href="#use-matchpwm-from-the-biostrings-package-to-match-the-motif-on-both-strands"></a>
</h2>
<p>We use a lenient match threshold reflecting our view that TF binding is often quite permissive and inexact.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hits.forward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/matchPWM.html" class="external-link">matchPWM</a></span><span class="op">(</span><span class="va">pfm</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dna</span><span class="op">)</span>, with.score<span class="op">=</span><span class="cn">TRUE</span>, min.score<span class="op">=</span><span class="st">"80%"</span><span class="op">)</span>
<span class="va">hits.reverse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/matchPWM.html" class="external-link">matchPWM</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/reverseComplement.html" class="external-link">reverseComplement</a></span><span class="op">(</span><span class="va">pfm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dna</span><span class="op">)</span>, with.score<span class="op">=</span><span class="cn">TRUE</span>, min.score<span class="op">=</span><span class="st">"80%"</span><span class="op">)</span>

<span class="va">tbl.forward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/range-squeezers.html" class="external-link">ranges</a></span><span class="op">(</span><span class="va">hits.forward</span><span class="op">)</span><span class="op">)</span>
<span class="va">tbl.reverse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/range-squeezers.html" class="external-link">ranges</a></span><span class="op">(</span><span class="va">hits.reverse</span><span class="op">)</span><span class="op">)</span>
<span class="va">tbl.forward</span><span class="op">$</span><span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">hits.forward</span><span class="op">)</span><span class="op">$</span><span class="va">score</span>
<span class="va">tbl.reverse</span><span class="op">$</span><span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">mcols</a></span><span class="op">(</span><span class="va">hits.reverse</span><span class="op">)</span><span class="op">$</span><span class="va">score</span>

<span class="va">tbl.matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tbl.forward</span>, <span class="va">tbl.reverse</span><span class="op">)</span>


<span class="va">tbl.matches</span><span class="op">$</span><span class="va">chrom</span> <span class="op">&lt;-</span> <span class="va">loc</span><span class="op">$</span><span class="va">chrom</span>
<span class="va">tbl.matches</span><span class="op">$</span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">tbl.matches</span><span class="op">$</span><span class="va">start</span> <span class="op">+</span> <span class="va">loc</span><span class="op">$</span><span class="va">start</span>
<span class="va">tbl.matches</span><span class="op">$</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="va">tbl.matches</span><span class="op">$</span><span class="va">end</span> <span class="op">+</span> <span class="va">loc</span><span class="op">$</span><span class="va">start</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-up-motif-logo-viewing">Set up motif logo viewing<a class="anchor" aria-label="anchor" href="#set-up-motif-logo-viewing"></a>
</h2>
<p>It can be useful to view the logo of the matched motif in context. igvR supports this with (at present) a little preparation:</p>
<ol style="list-style-type: decimal">
<li>tell igvR you wish to use this capability</li>
<li>add a recognizable “MotifDb::” protocol string to the motif name in the annotation track</li>
</ol>
<p>With this option enabled, and with the name (or label) field of an annotation bed data.frame carrying the prefix <em>MotifDb://</em>, then clicking on the motif element in <em>CTCF_MA0139.1</em> track, the corresponding motif will be displayed in a popup window. This is especially useful when your display has tracks for multiple motifs.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/enableMotifLogoPopups.html">enableMotifLogoPopups</a></span><span class="op">(</span><span class="va">igv</span><span class="op">)</span>

<span class="va">tbl.matches</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MotifDb::"</span>, <span class="va">motif.name</span><span class="op">)</span>
<span class="va">tbl.matches</span> <span class="op">&lt;-</span> <span class="va">tbl.matches</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chrom"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"name"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">tbl.matches</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="render-the-motif-matching-in-two-ways-with-two-tracks-one-for-annotation-one-for-score">Render the motif matching in two ways, with two tracks: one for annotation, one for score<a class="anchor" aria-label="anchor" href="#render-the-motif-matching-in-two-ways-with-two-tracks-one-for-annotation-one-for-score"></a>
</h2>
<p>In <em>igvR</em> we distinguish between <em>annotation</em> tracks, <em>quantitative</em> tracks, and <em>other</em> tracks (sucs as VCF and bam). Annotation tracks are a representation of the BED format. Quantitative tracks represent the WIG format.</p>
<p>In brief: imagine you have a data.frame with these five columns:</p>
<ol style="list-style-type: decimal">
<li>chrom</li>
<li>start</li>
<li>end</li>
<li>name</li>
<li>score</li>
</ol>
<p>Construct a DataFrameAnnotationTrack with columns 1-4.</p>
<p>Construct a DataFrameQuantitativeTrack with columns 1,2,3,5.</p>
<p>If the name (fourth) column contains the name of a MotifDb entry (e.g., “Hsapiens-jaspar2018-CTCF-MA0139.1”) then prepend “MotifDb://” to support the motif logo popup.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataFrameAnnotationTrack-class.html">DataFrameAnnotationTrack</a></span><span class="op">(</span><span class="st">"CTCF-MA0139.1"</span>, <span class="va">tbl.matches</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, color<span class="op">=</span><span class="st">"random"</span>,
                                  trackHeight<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track</span><span class="op">)</span>

<span class="va">track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataFrameQuantitativeTrack-class.html">DataFrameQuantitativeTrack</a></span><span class="op">(</span><span class="st">"MA0139.1 scores"</span>, <span class="va">tbl.matches</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>,
                                     color<span class="op">=</span><span class="st">"random"</span>, autoscale<span class="op">=</span><span class="cn">FALSE</span>, min<span class="op">=</span><span class="fl">8</span>, max<span class="op">=</span><span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="is-there-any-reason-to-believe-these-motif-matches-are-functional">Is there any reason to believe these motif matches are functional?<a class="anchor" aria-label="anchor" href="#is-there-any-reason-to-believe-these-motif-matches-are-functional"></a>
</h2>
<p>Motifs match to DNA sequence with great frequency, especially when (as above), a relaxed motif matching threshold is used. There are, however, three factors which increase the likelihood that the matches identify functional binding sites:</p>
<ol style="list-style-type: decimal">
<li>They are found in or near a high-confidence ChIP-seq site</li>
<li>The DNA sequence is highly conserved across species and time</li>
<li>The sequence is found in a known regulatory region associated with the target gene (here GATA2)</li>
</ol>
<p>The first factor can be see from direct inspection in the browser. For the second, let’s add the phastCons100way genome track, a Bioconductor annotation package which represents conserved sequence across 100 species over millions of years.</p>
<p>To obtain a fine-grained assessment of conservation, we use bins which are shorter than motifs. So here we add a conservation track which displays the conservation of every 5-base pair block. Conservation is scored between 0 and 1.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getGenomicRegion.html">getGenomicRegion</a></span><span class="op">(</span><span class="va">igv</span><span class="op">)</span>
<span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">loc</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span>, by<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="va">ends</span> <span class="op">&lt;-</span> <span class="va">starts</span> <span class="op">+</span> <span class="fl">5</span>
<span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">starts</span><span class="op">)</span>
<span class="va">tbl.blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>chrom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">loc</span><span class="op">$</span><span class="va">chrom</span>, <span class="va">count</span><span class="op">)</span>, start<span class="op">=</span><span class="va">starts</span>, end<span class="op">=</span><span class="va">ends</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">tbl.blocks</span><span class="op">)</span>

<span class="va">tbl.cons100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">gscores</span><span class="op">(</span><span class="va">phastCons100way.UCSC.hg19</span>, <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span><span class="va">tbl.blocks</span><span class="op">)</span><span class="op">)</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">tbl.cons100</span><span class="op">$</span><span class="va">chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">tbl.cons100</span><span class="op">$</span><span class="va">seqnames</span><span class="op">)</span>
<span class="va">tbl.cons100</span> <span class="op">&lt;-</span> <span class="va">tbl.cons100</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chrom"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"default"</span><span class="op">)</span><span class="op">]</span>
<span class="va">track</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataFrameQuantitativeTrack-class.html">DataFrameQuantitativeTrack</a></span><span class="op">(</span><span class="st">"cons100"</span>, <span class="va">tbl.cons100</span>, autoscale<span class="op">=</span><span class="cn">TRUE</span>, color<span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span>
<span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-methylation-tracks">Add Methylation Tracks<a class="anchor" aria-label="anchor" href="#add-methylation-tracks"></a>
</h2>
<p>H3K4me3 histone methylation marks are often associated with transcription initiation in promoter regions. We will add three tracks from the AnnotationHub for H3K4me3 methylation in <a href="https://www.genome.gov/26524238/encode-project-common-cell-types/" class="external-link">Gm12878</a> (lymphoblastoid) cells.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ah</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html" class="external-link">AnnotationHub</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">ah.human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ah</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Homo sapiens"</span><span class="op">)</span>

<span class="va">histone.tracks</span> <span class="op">&lt;-</span> <span class="fu">AnnotationHub</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html" class="external-link">query</a></span><span class="op">(</span><span class="va">ah.human</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H3K4me3"</span>, <span class="st">"Gm12878"</span>, <span class="st">"Peak"</span>, <span class="st">"narrow"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 3 tracks</span>
<span class="va">descriptions</span> <span class="op">&lt;-</span> <span class="va">histone.tracks</span><span class="op">$</span><span class="va">description</span>
<span class="va">titles</span> <span class="op">&lt;-</span> <span class="va">histone.tracks</span><span class="op">$</span><span class="va">title</span>
<span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">color.index</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="../reference/getGenomicRegion.html">getGenomicRegion</a></span><span class="op">(</span><span class="va">igv</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span>seqnames<span class="op">=</span><span class="va">chrom</span>, <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/IRanges-constructor.html" class="external-link">IRanges</a></span><span class="op">(</span>start<span class="op">=</span><span class="va">start</span>, end<span class="op">=</span><span class="va">end</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">histone.tracks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
   <span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">histone.tracks</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
   <span class="va">color.index</span> <span class="op">&lt;-</span> <span class="va">color.index</span> <span class="op">+</span> <span class="fl">1</span>
   <span class="va">gr</span> <span class="op">&lt;-</span> <span class="va">histone.tracks</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span>
   <span class="va">ov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/findOverlaps-methods.html" class="external-link">findOverlaps</a></span><span class="op">(</span><span class="va">gr</span>, <span class="va">roi</span><span class="op">)</span>
   <span class="va">histones</span> <span class="op">&lt;-</span> <span class="va">gr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Hits-class.html" class="external-link">queryHits</a></span><span class="op">(</span><span class="va">ov</span><span class="op">)</span><span class="op">]</span>
   <span class="va">track.histones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GRangesQuantitativeTrack-class.html">GRangesQuantitativeTrack</a></span><span class="op">(</span><span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">histones</span><span class="op">[</span>, <span class="st">"pValue"</span><span class="op">]</span>,
                                              color<span class="op">=</span><span class="va">colors</span><span class="op">[</span><span class="va">color.index</span><span class="op">]</span>, trackHeight<span class="op">=</span><span class="fl">50</span>,
                                              autoscale<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
   <span class="fu"><a href="../reference/displayTrack.html">displayTrack</a></span><span class="op">(</span><span class="va">igv</span>, <span class="va">track.histones</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
   <span class="op">}</span> <span class="co"># for track</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/showGenomicRegion.html">showGenomicRegion</a></span><span class="op">(</span><span class="va">igv</span>, <span class="st">"chr3:128,216,201-128,217,324"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="some-tentative-conclusions">Some tentative conclusions<a class="anchor" aria-label="anchor" href="#some-tentative-conclusions"></a>
</h2>
<p>The large ChIP-seq peak located in the middle of the large intron of GATA2-AS1 is centered on a good match to the CTCF Jaspar 2018 motif, and most of that sequence match intersects with highly conserved DNA. The co-occurrence of these three features suggests that this location is likely to be a functional binding site for CTCF.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Paul Shannon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
